
package Vista;
import biblioteca.LE; 
import logica.Administrador;


import logica.Cliente;
import logica.Controlador;
import logica.Usuario;


public class Login {
    
    Controlador controladora; 
    int detectaRegistroAdminUnico; 
    
    public Login(){
        controladora = new Controlador(); 
        detectaRegistroAdminUnico = 0; 
    }
    
    
    public void loginPrincipal(){
    
        String  msj = """
                        <<<< TIPO USUARIO  >>>
                      [1] Cliente
                      [2] Aministrador
                      [3] Salir
                      ------------------
                      Elija una opcion
                   """;
        int op;
        do {            
            op = LE.leerInt(msj); 
            
            switch (op) {
                case 1:
                    loginCliente(); 
                    break;
                case 2:
                    loginAdministrador();
                    break;
                case 3:
                    
                    break;
                default:
                    LE.mostrarAdvertencia("opcion invalida, vueva a ingresar");
            }
        } while (op != 3);
    }
    
    
    
    //apartado Cliente
    
    public void loginCliente() {

       
        int opc = 0;

        String msj = """
                        <<<< LOGIN  CLIENTE>>>
                      [1] Iniciar sesion
                      [2] Registrarse
                      [3] Volver
                      ------------------
                      Elija una opcion
                   """;

        do {
            opc = LE.leerInt(msj);
            switch (opc) {
                case 1:
                    if (controladora.traeContUsuarios() != 0) {
                        iniciasesionCliente();
                    }else{
                        LE.mostrarAdvertencia("Aún no hay usuarios registrados");
                    }
                    
                    break; 
                case 2:

                    registrarseCliente();
                    break; 
                case 3:

                   
                    break;

                default:
                    LE.mostrarAdvertencia("opcion invalida, vueva a ingresar");

            }

        } while (opc != 3);

    }

    private void iniciasesionCliente() {
        
        boolean incorrecto;  
        String nombreBuscar; 
        String contraseniaBuscar; 
        do {            
            incorrecto = true; 
            nombreBuscar = LE.leerString("Ingrese el nombre de usuario"); 
            contraseniaBuscar = LE.leerString("Ingrese contraseña");
            
            
            for (int i = 0; i < controladora.traeContUsuarios(); i++) {
                
                String nombreAlmacenado = controladora.traeUsuarioControlador(i).getNombreUsuario();
                String contrasenniaAlmacenada = controladora.traeUsuarioControlador(i).getContraseña(); 
                
                if (nombreAlmacenado.equals(nombreBuscar) && contrasenniaAlmacenada.equals(contraseniaBuscar)) {
                    incorrecto = false; 
                    principalCliente();
                } else {
                    LE.mostrarAdvertencia("Nombre de usuario o contraseña incorrectos");
                }
                
            }
        } while (incorrecto);

    }
    
    private String validarNombreUsuClienteInicioSesion() {

        Usuario[] usuarios = controladora.traeUsuarios();
        String nombreUsuarioRegistrar;
        int existe = -1;
        do {
            nombreUsuarioRegistrar = LE.leerString("Ingrese el nombre de usuario");

            for (int i = 0; i < controladora.traeContUsuarios(); i++) {

                if (usuarios[i].getNombreUsuario().equals(nombreUsuarioRegistrar)) {
                    existe = i;
                    break;
                }
            }

            if (existe != -1) {
                LE.mostrarAdvertencia("El nombre de usuario ya existe, vuelva a ingresar");
            } else {
                LE.mostrarInformacion("nombre de usuario valido");
            }

        } while (existe != -1);

        return nombreUsuarioRegistrar;
    }

    
    private void principalCliente(){
    //pagina principal de cliente

  boolean seguir = false;

        String menu = "********************"
                + "\n[1]Comprar juego"
                + "\n[2]Ordenar inventario de juegos por nombre"
                + "\n[3]Visualizar inventario de juegos"
                + "\n[4]Ingresar saldo"
                + "\n[5]Volver al menú principal"
                + "\n********************";

        String[] opciones = {"1", "2", "3", "4", "5"};

        do {

            int opc = JOptionPane.showOptionDialog(null,
                    menu,
                    "Menu",
                    JOptionPane.DEFAULT_OPTION,
                    JOptionPane.PLAIN_MESSAGE,
                    null,
                    opciones,
                    opciones[0]);

            switch (opc) {

                case 0:

                    comprar();

                    seguir = true;
                    break;

                case 1:
                    ordenarInv();
                    inventarioJuegos();
                    seguir = true;
                    break;

                case 2:
                    inventarioJuegos();
                    seguir = true;
                    break;

                case 3:

                    saldo();
                    seguir = true;
                    break;

                case 4:
                    seguir = false;
                    break;

            }

        } while (seguir);

    }


    public void comprar() {

        boolean seguir = false;

        String menu = "********************"
                + "\n[1]Comprar juego"
                + "\n[2]Historial de compras"
                + "\n[3]Volver al menú"
                + "\n********************"
                + "\nSaldo actual: " + nuevosaldo;

        String[] opciones = {"1", "2", "3"};

        do {

            int opc = JOptionPane.showOptionDialog(null,
                    menu,
                    "Menu",
                    JOptionPane.DEFAULT_OPTION,
                    JOptionPane.PLAIN_MESSAGE,
                    null,
                    opciones,
                    opciones[0]);

            switch (opc) {

                case 0:

                    comprarJuego();

                    seguir = true;
                    break;
                case 1:

                    historial();
                    seguir = true;
                    break;
                case 2:

                    seguir = false;
                    break;

            }

        } while (seguir);

    }








    }

    private void registrarseCliente() {

        String nombre, apellido;
        long codCliente = controladora.traeContCliente();

        LE.mostrarInformacion("Registrando nuevo cuenta de Cliente");

        nombre = LE.leerString("Ingrese el nombre");
        apellido = LE.leerString("Ingrese el apellido");

        //tipo de usuario
        String nombreUsuario, contraseniaUsu;
        String rol = "Cliente";
        long codUsuario = controladora.traeContUsuarios();

        nombreUsuario = validarNombreUsuClienteRegistro(); 
        contraseniaUsu = LE.leerString("Ingrese la contraseña");
        

        Usuario usu = new Usuario(codUsuario, nombreUsuario, contraseniaUsu, rol);
        Cliente clien = new Cliente(codCliente,0, usu, nombre, apellido); 
        
        controladora.creaUsuario(usu); 
        controladora.creaCliente(clien);
    }

    
    private String validarNombreUsuClienteRegistro(){
        
      
        Usuario[] usuarios = controladora.traeUsuarios();
        String nombreUsuarioRegistrar; 
        int existe = -1; 
        do {    
            nombreUsuarioRegistrar = LE.leerString("Ingrese el nombre de usuario"); 
            
            for (int i = 0; i < controladora.traeContUsuarios(); i++) {

                if (usuarios[i].getNombreUsuario().equals(nombreUsuarioRegistrar)) {
                    existe = i; 
                    break;
                }
            }
            
            if (existe != -1) {
                LE.mostrarAdvertencia("El nombre de usuario ya existe, vuelva a ingresar");
            }else{
                LE.mostrarInformacion("nombre de usuario valido");
            }
            
        } while (existe != -1);
        
        return nombreUsuarioRegistrar; 
    }

    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    //apartado Administrador
    
    public void loginAdministrador(){
        
        String  msj = """
                        <<<< LOGIN  ADMINISTRADOR >>>
                      [1] Iniciar sesion
                      [2] Registrarse 
                      [3] Mostrar datos 
                      [4] Modificar datos 
                      [5] Volver
                      ------------------
                      Elija una opcion
                   """;
        int op;
        do {            
            op = LE.leerInt(msj); 
            
            switch (op) {

                case 1:

                    if (detectaRegistroAdminUnico != 0) {
                        iniciasesionAdministrador(); 
                    }else{
                        LE.mostrarAdvertencia("El administrador aun no se encuentra registrado");
                    }
                    
                    break;
                    
                    
                case 2:
                    
                    if (detectaRegistroAdminUnico < 1) {
                        registrarseAdministrador();
                        detectaRegistroAdminUnico++;
                    }else{
                        LE.mostrarAdvertencia("Ya no se pueden registrar mas administradores");
                    }

                    break;
                case 3:
                    if (detectaRegistroAdminUnico != 0) {                        
                        mostrarDatosAdministrador(); 
                    }else{
                        LE.mostrarAdvertencia("El administrador aun no se encuentra registrado");
                    }
                    
                    break;
                case 4:
                    if (detectaRegistroAdminUnico != 0) {                        
                        //modificar daros del administrador
                    }else{
                        LE.mostrarAdvertencia("El administrador aun no se encuentra registrado");
                    }
                    break;
                case 5:
                    
                    break;
                default:
                    LE.mostrarAdvertencia("opcion invalida, vueva a ingresar");
            }
        } while (op != 5);
                
        
    
    }
    
    private void iniciasesionAdministrador() {
        String nombreBuscar = LE.leerString("Ingrese el nombre de usuario"); 
        String contraseniaBuscar =  LE.leerString("Ingrese contraseña"); 
        
        
        String nombreAlmacenado = controladora.obtenerAdmin().getUsu().getNombreUsuario(); 
        String contraseniaAlmacenada = controladora.obtenerAdmin().getUsu().getContraseña(); 
        
     
        if (nombreAlmacenado.equals(nombreBuscar) && contraseniaAlmacenada.equals(contraseniaBuscar)) {
            menuAdministrador(); 
        }else{
            LE.mostrarAdvertencia("Nombre de usuario o contraseña incorrecotos");
        }
        
        
        
    }
    
    private void menuAdministrador() {
    }

    private void registrarseAdministrador() {
        
        String nombre, apellido, numDNI, fechaNacimiento; 
        long codAdmin = 0; 
        
        LE.mostrarInformacion("Creando cuenta de administrador unico");
        
        nombre = LE.leerString("Ingrese el nombre"); 
        apellido = LE.leerString("Ingrese el apellido"); 
        numDNI = LE.leerString("Ingrese el numero de DNI"); 
        fechaNacimiento = LE.leerString("Ingrese la fecha de nacimiento"); 
        
        //tipo de usuario
        
        String nombreUsuario, contraseniaUsu; 
        String  rol= "Administrador"; 
        long codUsuario = 0; 

        nombreUsuario = LE.leerString("Ingrese el nombre de ususario");
        contraseniaUsu = LE.leerString("Ingrese la contraseña");
    
        Usuario usu = new Usuario(codUsuario, nombreUsuario, contraseniaUsu, rol); 
        Administrador  admin= new Administrador(codAdmin, numDNI, fechaNacimiento, usu, nombre, apellido); 
        
        controladora.creaAdmin(admin);
    }

    public void mostrarDatosAdministrador(){
        LE.mostrarInformacion(controladora.obtenerAdmin( ).toString());
        
    }

    private void modificaDatosAdministrador(){
        
        
    }
    
    
    

}



}
